<label
  class="text-primary"
  for="p_microredes_establec"
  name="p_microredes_establec"
  >MICRORED :
</label>
<select
  class="form-control custom-select"
  name="p_microredes_establec"
  id="p_microredes_establec"
  hx-get="{% url 'p_establecimientos_pn_poblacion' %}"
  hx-trigger="change"
  hx-target="#p_establecimientos"
  hx-include="[name='red'], [name='p_microredes_establec']"
>
  <option value="">--- SELECCIONAR ---</option>
  {% for m in microredes %}
  <option value="{{ m.Codigo_MicroRed }}">{{ m.MicroRed }}</option>
  {% endfor %}
  {% if not microredes %}
  <option value="" disabled>No hay microredes disponibles</option>
  {% endif %}
</select>

{% if is_htmx %}
<!--- INCLUDE DROP INCLUYENTE ESTABLECIMIENTO --->
<div class="row">
  <div class="col-md-12">
    <div class="form-group">
      <div id="p_establecimientos" hx-swap-oob="true">
        {% include 'pn_poblacion/partials/p_establecimientos.html' %}
      </div>
    </div>
  </div>
</div>
<!--- FIN INCLUDE DROP INCLUYENTE ESTABLECIMIENTO --->

<!-- Debug JavaScript -->
<script>
document.getElementById('p_microredes_establec').addEventListener('change', function() {
    console.log('DEBUG JS - Microred seleccionada:', this.value);
    var redElement = document.getElementById('red');
    if (redElement) {
        console.log('DEBUG JS - Red actual:', redElement.value);
        console.log('DEBUG JS - Red element existe:', true);
    } else {
        console.log('DEBUG JS - Red element NO existe');
    }
    
    // Verificar todos los campos del formulario
    var form = this.closest('form');
    if (form) {
        var formData = new FormData(form);
        console.log('DEBUG JS - Todos los campos del formulario:');
        for (var pair of formData.entries()) {
            console.log('DEBUG JS -', pair[0] + ':', pair[1]);
        }
    }
});
</script>
{% endif %}
