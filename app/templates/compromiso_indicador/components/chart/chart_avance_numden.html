<!-- Card para mostrar numerador y denominador -->
<script>
window.renderChartAvanceNumDen = function(data, params) {
    const container = document.getElementById("detalle-avance-numden-container");
    if (!container) {
        console.error("Contenedor para num/den no encontrado");
        return;
    }

    try {
        const extractValue = (rawValue) => {
            if (rawValue == null) return 0;
            const value = Array.isArray(rawValue) ? rawValue[0] : rawValue;
            return parseInt(value, 10) || 0;
        };

        const numerador = extractValue(data.r_numerador_resumen);
        const denominador = extractValue(data.r_denominador_resumen);
        const brecha = denominador - numerador;
        const avance = denominador > 0 ? (numerador / denominador) * 100 : 0;

        let clasificacion, colorClass, iconClass;
        if (avance >= 75) {
            clasificacion = "CUMPLE";
            colorClass = "success";
            iconClass = "check-circle";
        } else if (avance >= 33) {
            clasificacion = "PROCESO";
            colorClass = "warning";
            iconClass = "clock";
        } else {
            clasificacion = "RIESGO";
            colorClass = "danger";
            iconClass = "exclamation-triangle";
        }

        const cardHTML = `
          <div class="card border-${colorClass}">
            <div class="card-header bg-${colorClass} text-white">
              <h6 class="mb-0"><i class="fas fa-${iconClass} mr-2"></i>RESUMEN </h6>
            </div>
            <div class="card-body p-2">
              <div class="row text-center">
                <div class="col-4">
                  <div class="border-right">
                    <i class="fas fa-users text-success mb-1" style="font-size: 0.8rem;"></i>
                    <h6 class="text-success mb-0 style="font-size: 0.8rem;"">Den</h6>
                    <h5 class="font-weight-bold mb-0">${denominador.toLocaleString()}</h5>
                    <small class="text-muted">Meta</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="border-right">
                    <i class="fas fa-rocket text-primary mb-1" style="font-size: 0.8rem;"></i>
                    <h6 class="text-primary mb-0 style="font-size: 0.8rem;"">Num</h6>
                    <h5 class="font-weight-bold mb-0">${numerador.toLocaleString()}</h5>
                    <small class="text-muted">Alcanzado</small>
                  </div>
                </div>
                <div class="col-4">
                  <i class="fas fa-percentage text-${colorClass} mb-1" style="font-size: 0.8rem;"></i>
                  <h6 class="text-${colorClass} mb-0">Avance</h6>
                  <h5 class="font-weight-bold mb-0">${avance.toFixed(1)}%</h5>
                  <small class="text-${colorClass}">${clasificacion}</small>
                </div>
              </div>
              <hr class="my-2">
              <div class="row text-center">
                <div class="col-12">
                  <small class="text-muted">
                    <i class="fas fa-minus-circle text-danger mr-1"></i>
                    Brecha: <strong>${brecha.toLocaleString()}</strong> casos por atender
                  </small>
                </div>
              </div>
            </div>
          </div>
        `;
        container.innerHTML = cardHTML;
    } catch (error) {
        console.error("Error al renderizar la tarjeta de num/den:", error);
        container.innerHTML = '<div class="alert alert-danger">Error al mostrar datos</div>';
    }
};
</script>
